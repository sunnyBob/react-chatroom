namespace: 'groups'

findGroup:
  - select * from groups
  - where 1 = 1
  - if:
      test: :id
      sql: and id = :id
  - if:
      test: :userId
      sql: and create_user_id = :userId

findManageGroup:
  - select g.* from groups g, manager_group m
  - where g.id = m.group_id
  - and m.user_id = :userId

findJoinedGroup:
  - select g.* from groups g, user_group u
  - where u.group_id = g.id
  - and g.create_user_id != :userId
  - and u.user_id = :userId
  - and u.user_id not in (
      select user_id from manager_group
    )

findGroupUser:
  - select user.* from groups g, user_group u, user
  - where u.group_id = g.id and user.id = u.user_id
  - and u.group_id = :groupId
  - if:
      test: :userId
      sql: and user_id = :userId
  - if:
      test: :userName
      sql: and username like :userName
  - limit :limit
  - offset :offset

findManageGroups:
  - select groups.* from groups left join manager_group
  - on groups.id = manager_group.group_id
  - where (manager_group.user_id = :userId or groups.create_user_id = :userId)
  - if:
      test: :groupId
      sql: and groups.group_id = :groupId

findGroupUsersCount:
  - select count(1) from groups g, user_group u, user
  - where u.group_id = g.id and user.id = u.user_id
  - and u.group_id = :groupId

findGroupMaleCount:
  - select count(1) from groups g, user_group u, user
  - where u.group_id = g.id and user.id = u.user_id
  - and u.group_id = :groupId and user.sex = 'ç”·'

findAfter90Count:
  - select count(1) from groups g, user_group u, user
  - where u.group_id = g.id and user.id = u.user_id
  - and u.group_id = :groupId and user.age between 19 and 28

findCreaterOrManager:
  - select g.create_user_id, m.group_id manager_id from groups g LEFT JOIN manager_group m on g.id = m.group_id
  - and ((g.create_user_id = :userId and g.id = :groupId) or (m.user_id = :userId and m.group_id = :groupId))

delMember:
  - delete from user_group
  - where user_id = :user_id and group_id = :group_id

delManager:
  - delete from manager_group
  - where user_id = :user_id and group_id = :group_id
